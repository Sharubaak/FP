<% include partials/header.ejs %>
<% include partials/main_nav.ejs%>

<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/Content/survey.css">
  <title><%= title %></title>
</head>
<body>
<main>
  <div class="jumbotron">
    <h1 class="display-4">Welcome to <%= title %></h1>
    <p class="lead">Add, view, and manage survey entries below.</p>
    <hr class="my-4">
  </div>

  <div>
    <h2>Add New Survey Entry</h2>

    <!-- Form for adding a new survey entry -->
    <form action="/survey/add" method="POST">
      <label for="studentName">Student Name:</label>
      <input type="text" name="studentName" placeholder="Enter full name" required><br><br>

      <label for="studentId">Student ID:</label>
      <input type="text" name="studentId" placeholder="Enter student ID" required><br><br>

      <label for="country">Country of Origin:</label>
      <input type="text" name="country" placeholder="Enter country of origin" required><br><br>

      <label for="program">Academic Program:</label>
      <input type="text" name="program" placeholder="Enter program name" required><br><br>

      <button type="submit" class="hero-button" onclick="addSurvey">Add to Survey</button>
    </form>

    <!-- Table displaying survey entries -->
    <h2>Survey Entries</h2>
    <table id="surveyTable">
      <thead>
        <tr>
          <th>Student Name</th>
          <th>Student ID</th>
          <th>Country</th>
          <th>Program</th>
          <th>Actions</th>
        </tr>
      </thead>
      <form action="/survey/delete" method="POST" style="display:inline;">
        <input type="hidden" name="studentId" value="<%= survey.studentId %>">
        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
      </form>
    </table>
  </div>
</main>

<script>
  // Function to handle adding a survey entry
  async function addSurvey() {
    const studentName = document.getElementById('studentName').value;
    const studentId = document.getElementById('studentId').value;
    const country = document.getElementById('country').value;
    const program = document.getElementById('program').value;

    if (!studentName || !studentId || !country || !program) {
      alert('All fields are required.');
      return;
    }

    try {
      const response = await fetch('/survey/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ studentName, studentId, country, program })
      });

      if (response.ok) {
        const newRow = `
          <tr>
            <td>${studentName}</td>
            <td>${studentId}</td>
            <td>${country}</td>
            <td>${program}</td>
            <td>
              <button class="btn btn-info btn-sm" onclick="editSurvey('${studentName}', '${studentId}')">Edit</button>
              <button class="btn btn-danger btn-sm" onclick="deleteSurvey('${studentName}', '${studentId}')">Delete</button>
            </td>
          </tr>`;
        document.querySelector('#surveyTable tbody').insertAdjacentHTML('beforeend', newRow);

        // Clear the form
        document.getElementById('surveyForm').reset();
      } else {
        alert('Failed to add the survey entry.');
      }
    } catch (err) {
      console.error('Error:', err);
      alert('An error occurred while adding the survey entry.');
    }
  }
</script>
</body>
</html>


